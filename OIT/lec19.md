### **Конспект лекции №19**
**Дисциплина:** Основы информационных технологий
**Тема:** Дополнительные наборы команд: MMX, 3DNow!, SSE, SSE2, SSE3

---

#### **1. Введение: Новая проблема — мультимедиа**

К середине 1990-х годов компьютеры стали массово использоваться для работы с графикой, аудио и видео. Эти задачи имеют общую черту:
*   **Параллелизм:** Одна и та же операция (например, изменение яркости) должна быть применена к множеству элементов данных (пикселям изображения или семплам звука).
*   **Целочисленные операции:** Изначально графика и звук обрабатывались с помощью целых чисел.

Обрабатывать такие данные по одному элементу стандартными целочисленными командами x86 было **очень медленно**. Нужно было новое решение.

---

#### **2. MMX (MultiMedia eXtension) — Первый шаг**

*   **Кто и когда:** Intel, 1997 год (процессор Pentium MMX).
*   **Идея:** Реализовать **SIMD-парадигму**.
    *   **SIMD (Single Instruction, Multiple Data):** Одна команда выполняется над несколькими данными одновременно.
*   **Техническая реализация:**
    *   Добавлено **57 новых команд** (набор `MMX`).
    *   Были задействованы **регистры сопроцессора x87 (ST0-ST7)**, но представлены как восемь новых 64-битных регистров (`MM0-MM7`).
    *   Один 64-битный регистр `MMX` мог содержать несколько данных меньшей разрядности:
        *   8 байт (8 × 8 бит)
        *   4 слова (4 × 16 бит)
        *   2 двойных слова (2 × 32 бита)
*   **Главный недостаток:**
    *   **Отсутствие поддержки операций с плавающей точкой.** MMX работал только с целыми числами.
    *   Конфликт за регистры с x87 приводил к потере производительности при переключении между задачами с плавающей точкой и MMX.

*   **Аналогия:** Представьте, что раньше вы могли перекладывать по одному апельсину (скалярная обработка). С MMX вы получили коробку, в которую помещается 8 апельсинов, и можете перекладывать все 8 сразу одной командой.

---

#### **3. 3DNow! — Ответ AMD**

*   **Кто и когда:** AMD, 1998 год (процессоры K6-2).
*   **Идея:** Исправить главный недостаток MMX — добавить **SIMD-операции с плавающей точкой одинарной точности (single-precision)**.
*   **Техническая реализация:**
    *   **21 новая команда.**
    *   Использовал те же 64-битные регистры, что и MMX.
    *   Мог оперировать двумя числами с плавающей точкой (32-бит) в одном регистре.
*   **Значение:** Дало значительный прирост в 3D-играх того времени, так как расчёты геометрии и преобразований требуют операций с плавающей точкой.
*   **Исторический итог:** Был популярен в эпоху процессоров AMD K6-2 и K7 (Athlon), но в конечном счёте уступил более продвинутому стандарту от Intel — SSE.

---

#### **4. SSE (Streaming SIMD Extensions) — Новый уровень**

*   **Кто и когда:** Intel, 1999 год (процессор Pentium III).
*   **Идея:** Предоставить полноценный SIMD для чисел с плавающей точкой, не мешая работе x87.
*   **Техническая реализация (революция):**
    *   **70 новых команд.**
    *   Введён **новый, независимый набор из восьми 128-битных регистров** (`XMM0-XMM7`).
    *   Регистр `XMM` мог содержать:
        *   4 числа с плавающей точкой одинарной точности (4 × 32 бита).
*   **Ключевые преимущества перед MMX/3DNow!:**
    1.  **Отдельные регистры:** Нет конфликта с x87.
    2.  **Большая разрядность (128 бит):** Обработка 4 чисел за такт вместо 2 у 3DNow!.
    3.  **Команды работы с кэшем:** Команды для эффективной потоковой обработки данных (например, `PREFETCH`, `MOVNTPS`).

---

#### **5. SSE2 — Стандартизация и расширение**

*   **Кто и когда:** Intel, 2000 год (процессор Pentium 4).
*   **Идея:** Довести SSE до зрелости, сделав его универсальным инструментом.
*   **Техническая реализация:**
    *   **144 новые команды** (в основном, расширение возможностей SSE).
    *   Используются те же 128-битные регистры `XMM`.
    *   **Главные нововведения:**
        1.  **SIMD для целых чисел всех размеров** (включая 64-битные). Это сделало MMX практически ненужным.
        2.  **Поддержка чисел с плавающей точкой двойной точности (double-precision)** — 2 числа в одном регистре.
*   **Значение:** SSE2 стал **фундаментальным набором** для 64-битной архитектуры x86-64 (AMD64). Любой процессор, совместимый с x86-64, обязан поддерживать SSE2. Это "новый минимум".

---

#### **6. SSE3 — Доводка и оптимизация**

*   **Кто и когда:** Intel, 2004 год (процессор Pentium 4 Prescott).
*   **Идея:** Добавить команды для оптимизации конкретных задач и упрощения программирования.
*   **Техническая реализация:**
    *   **Всего 13 новых команд.**
    *   Не вводил новых регистров.
    *   Примеры полезных команд:
        *   `ADDSUBPS` — сложение и вычитание в одной команде (полезно для быстрого преобразования Фурье).
        *   `HADDPS` — горизонтальное сложение соседних чисел в регистре.
        *   Команды для работы с потоками (`MONITOR`, `MWAIT`).

---

#### **7. Сравнительная таблица эволюции SIMD**

| Набор | Год | Разработчик | Ключевое нововведение | Регистры | Данные (пример) |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **MMX** | 1997 | Intel | SIMD для целых чисел | 8 × 64-бит (совмещ. с x87) | 8 байт, 4 слова, 2 д.слова |
| **3DNow!**| 1998 | AMD | SIMD для чисел с плав. точ. (SP) | 8 × 64-бит (совмещ. с x87) | 2 числа float (32-бит) |
| **SSE** | 1999 | Intel | SIMD для float (SP) + новые регистры | 8 × 128-бит (`XMM0-7`) | 4 числа float (32-бит) |
| **SSE2** | 2000 | Intel | SIMD для целых и double | 8 × 128-бит (`XMM0-7`) | 2 числа double (64-бит), 16 байт |
| **SSE3** | 2004 | Intel | Команды оптимизации | (без новых регистров) | Горизонтальные операции |

*SP - Single Precision (одинарная точность)*

---

#### **8. Итог и связь с современностью**

Эволюция на этом не остановилась. За SSE3 последовали:
*   **SSSE3, SSE4** — ещё больше специализированных команд.
*   **AVX (Advanced Vector Extensions)** — следующий гигантский скачок: **256-битные регистры (`YMM`)**.
*   **AVX-512** — современный стандарт с **512-битными регистрами**, используемый в серверных и высокопроизводительных процессорах.

**Вывод:**
MMX, 3DNow!, SSE, SSE2, SSE3 — это этапы "гонки вооружений" между Intel и AMD, направленной на ускорение мультимедийных и научных вычислений. Они заложили основу современной высокопроизводительной обработки данных по принципу **SIMD**, который сегодня используется повсеместно.

---

**Домашнее задание / Вопросы для самоконтроля:**
1.  Какую фундаментальную парадигму (принцип) обработки данных ввели наборы команд MMX/SSE? Дайте её расшифровку и краткое объяснение.
2.  В чём было главное архитектурное преимущество SSE перед MMX и 3DNow!?
3.  Почему набор SSE2 можно считать более важным вехой, чем SSE?
4.  *Для любознательных:* Проведите небольшое исследование. Какие современные приложения и игры активно используют инструкции AVX?